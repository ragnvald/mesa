flowchart TB
  %% MESA system overview (high level)

  subgraph UI[Desktop application]
    Mesa[Mesa desktop - Tkinter, ttkbootstrap]
    Import[Import]
    Setup[Set up]
    Process[Process]
    Segments[Segments]
    Atlas[Atlas]
    Maps[Maps overview - Leaflet, pywebview]
    AnalysisSetup[Analysis setup]
    AnalysisPresentation[Analysis presentation]
    Report[Report engine]
  end

  subgraph Stores[Project stores]
    GeoP[GeoParquet store - output/geoparquet - tbl_*.parquet]
    MB[MBTiles store (SQLite) - output/mbtiles - group_kind.mbtiles]
  end

  subgraph External[External services]
    Basemaps[External basemaps - OSM, OpenTopo, Esri, Bing]
  end

  subgraph Cache[Cache]
    TileCache[Basemap tile cache - output/tile_cache]
  end

  subgraph Ops[Config and observability]
    Config[Project configuration and logs - config.ini, secrets, log.txt]
  end

  subgraph Outputs[Deliverables]
    Deliver[Deliverables - reports, area_stats.json, MBTiles, atlas artifacts]
  end

  %% Core flows
  Mesa --> Import
  Mesa --> Setup
  Mesa --> Process
  Mesa --> Segments
  Mesa --> Atlas
  Mesa --> Maps
  Mesa --> AnalysisSetup
  Mesa --> AnalysisPresentation
  Mesa --> Report

  Import --> GeoP
  Process --> GeoP
  Segments --> GeoP

  %% Tile generation
  GeoP --> Raster[Raster tile builder - create_raster_tiles.py/.exe]
  Raster --> MB

  %% Viewing
  MB --> Maps
  Maps --> Basemaps

  %% Basemap caching for tile-building
  Basemaps --> TileCache
  TileCache --> Raster

  %% Outputs
  Report --> Deliver
  GeoP --> Deliver
  MB --> Deliver

  %% Shared config/logs
  Config --> Mesa
